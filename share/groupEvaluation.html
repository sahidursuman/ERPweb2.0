<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>跟团评价 - 火柴头</title>
	<link rel="stylesheet" href="../components/ace-admin/assets/css/bootstrap.min.css" />
	<link rel="stylesheet" href="../components/ace-admin/assets/font-awesome/4.4.0/css/font-awesome.min.css" />
	<link rel="stylesheet" href="../css/base.css" />
	<link rel="stylesheet" href="../css/manner.css" />
	<style type="text/css">
		body{
			min-width: auto;
		}
		.container-fluid{
			margin: auto;
			width: auto;
			max-width: 680px;
		}
		a.control-label,
		label.control-label{
			font-size: 12px;
			color: #313131;
			font-weight: normal;
		}
		.note-guide-info p{
			font-size: 14px;
			color: #313131;
		}
	</style>
</head>
<body>
<div class="container-fluid globalAdd hct-min-width" id="groupEvaluationContent">
</div>
<script id="groupEvaluation" type="text/html">
	<div class="row hct-top-header">
		<div class="col-xs-12">
			<span class="fa fa-ellipsis-v" style="color: #e2b058;"></span>
			<label class="control-label mar-l-10">{{note.title}}</label>
		</div>
	</div>
	<div class="row hct-note">
		<div class="col-xs-12">
			<a class="pull-left cursor" href="guideEvaluate.html?noteId={{note.id}}" data-id="{{note.id}}">
				<div class="caption-user-header pull-left{{if !note.guideInfo.photo}} default-img{{/if}}">
					{{if note.guideInfo.photo}}<img src="{{imgUrl + note.guideInfo.photo}}">{{/if}}
				</div>
				<div class="note-guide-info pull-left">
					<p class="pull-left">{{note.guideInfo.name}}</p>
					<p class="pull-left starLevel">{{#note.guideInfo.guideSatisfaction | getScoreStar}}</p>
				</div>
			</a>
			<div class="pull-right note-date">
				<p>
					<label class="control-label">出行日期：{{note.updateTime}}</label>
	        		<label class="control-label mar-l-10">出游天数：{{note.days}}天</label>
	        	</p>
			</div>
		</div>
		<div class="col-xs-12 score-body">
			<div class="pull-left note-score">
				<p class="scoreCount">{{note.tripSatisfaction}}%</p>
				<p class="starLevel">{{#note.tripSatisfaction | getScoreStar}}</p>
			</div>
			<div class="pull-left note-line-score">
				<p>此线路产品跟团游客满意度为{{note.tripSatisfaction}}%</p>
				<p>已有{{note.scoreCount}}人评分</p>
			</div>
			<div class="pull-right p-no-mar">
				<p>&nbsp;</p>
				<p class="comment-info">
					<label class="control-label"><i class="fa fa-heart"></i>{{note.likeCount}}</label>
	        		<label class="control-label mar-l-15"><i class="fa fa-comment"></i>{{note.commentCount}}</label>
	        		<label class="control-label mar-l-15"><i class="fa fa-share-alt"></i>{{note.shareCount}}</label>
	        		<label class="control-label mar-l-15"><i class="fa fa-eye"></i>{{note.viewCount}}</label>
				</p>
			</div>
		</div>
	</div>
	<div class="comment-container">
		<div class="note-db-img">
			<img src="{{imgUrl + note.coverImage}}" alt="{{note.title}}">
		</div>
	</div>
	<div class="praise-content">
		<div class="praise-cont-head">
			收到的赞 {{note.likeCount}}
		</div>
		<ul class="praise-cont-body">
			{{each note.noteLikeList as like}}
			<li class="{{if !like.photo}}default-img{{/if}}">
				{{if like.photo}}
				<img src="{{like.photo}}" alt="{{like.name}}">
				{{/if}}
			</li>
			{{/each}}
		</ul>
	</div>
	<div class="comment-content">
		<div class="comment-cont-head">
			收到的评论 {{note.commentCount}}
		</div>
		<div class="comment-cont-body">
			{{each note.noteCommentList as comment}}
			<div class="comment-cont-item">
				<div class="comment-user">
					<div class="caption-user-header pull-left{{if !comment.photo}} default-img{{/if}}">
						{{if comment.photo}}<img src="{{imgUrl + comment.photo}}">{{/if}}
					</div>
					<div class="pull-left comment-cont-name">
						{{comment.name}}
					</div>
					<div class="pull-right comment-cont-date">{{comment.createTime}}</div>
				</div>
				<div class="comment-cont-text">
					<p>{{comment.commentContent}}</p>
				</div>
				<ul class="comment-cont-images">
					{{each comment.images as img}}
					<li>
						<a href="{{imgUrl + img}}" class="T-photos"><img src="{{imgUrl + img}}"></a>
					</li>
					{{/each}}
				</ul>
			</div>
			{{/each}}
		</div>
	</div>
</script>
	<script src="../components/ace-admin/assets/js/jquery.1.11.1.min.js" type="text/javascript"></script>
	<script src="../js/libs/template.js" type="text/javascript"></script>
	<script type="text/javascript">
		template.helper("getScoreStar", function(str, scoreType){
		    var res = "", star = ['fa-star-o', 'fa-star-o', 'fa-star-o', 'fa-star-o', 'fa-star-o'];
		    if(str > 4 && str < 15){
		        star[0] = "fa-star-half-o";
		    }else if(str >= 15  &&  str < 25){
		        star[0] = "fa-star";
		    }else if(str >= 25 &&  str < 35){
		        star[0] = "fa-star";
		        star[1] = "fa-star-half-o";
		    }else if(str >= 35 &&  str < 45){
		        star[0] = "fa-star";
		        star[1] = "fa-star";
		    }else if(str >= 45 &&  str < 55){
		        star[0] = "fa-star";
		        star[1] = "fa-star";
		        star[2] = "fa-star-half-o";
		    }else if(str >= 55 &&  str < 65){
		        star[0] = "fa-star";
		        star[1] = "fa-star";
		        star[2] = "fa-star";
		    }else if(str >= 65 &&  str < 75){
		        star[0] = "fa-star";
		        star[1] = "fa-star";
		        star[2] = "fa-star";
		        star[3] = "fa-star-half-o";
		    }else if(str >= 75 &&  str < 85){
		        star[0] = "fa-star";
		        star[1] = "fa-star";
		        star[2] = "fa-star";
		        star[3] = "fa-star";
		    }else if(str >= 85 &&  str < 95){
		        star[0] = "fa-star";
		        star[1] = "fa-star";
		        star[2] = "fa-star";
		        star[3] = "fa-star";
		        star[4] = "fa-star-half-o";
		    }else if(str >= 95){
		        star[0] = "fa-star";
		        star[1] = "fa-star";
		        star[2] = "fa-star";
		        star[3] = "fa-star";
		        star[4] = "fa-star";
		    }
		    if(scoreType == "1"){
		        for(var j=0; j<str * 1;j++){
		            star[j] = "fa-star";
		        }
		    }
		    for(var i=0; i<star.length; i++){
		        res += '<i class="fa '+star[i]+'"></i>';
		    }
		    return res;
		});
		function getQueryString(name) {
		    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
		    var r = window.location.search.substr(1).match(reg);
		    if (r != null) return unescape(r[2]); 
		    return null;
		}
		$.ajax({
			url : "/huochaitou/base.do?method=findNoteCommentById",
			data : {noteId : getQueryString("noteId"), fromOut : 1},
			type : "POST",
			success : function(data){
				if(!!data){
					var imgUrl = "http://7xlg3o.com2.z0.glb.qiniucdn.com/";//正式的图片地址
						imgUrl  = "http://7xlw2q.com2.z0.glb.qiniucdn.com/"; //测试
					data.imgUrl = imgUrl;
					var commentList = data.note.noteCommentList;
	                for(var i=0; i<commentList.length; i++){
	                    if(!!commentList[i].commentImages){
	                        commentList[i].images = commentList[i].commentImages.split(",");
	                    }else{
	                        commentList[i].images = [];
	                    }
	                }
	                data.note.noteCommentList = commentList;
				    var html = template('groupEvaluation', data);
				    document.getElementById('groupEvaluationContent').innerHTML = html;
				}
			}
		})
	</script>
</body>
</html>