<div class="ui-sortable-handle widget-container-col">
    <h5 class="title-size">
        <i class="ace-icon fa fa-medkit"></i> 车费
        <a href="javascript:void(0)" class="T-buspay-add">
            <button class="btn btn-sm btn-success T-add" style="margin-left: 20px">
                <i class="ace-icon fa fa-plus"></i>
                新增
            </button>
        </a>
    </h5>
</div>
<div class="overflow-x min-w-1050">
    <table class="table overflow-table  table-striped table-bordered table-hover w-1500">
        <thead>
        <tr>
            <th class="th-border" rowspan="2"><span class="necessary">*</span>开始时间</th>
            <th class="th-border" rowspan="2"><span class="necessary">*</span>结束时间</th>
            <th class="th-border" rowspan="2"><span class="necessary">*</span>任务</th>
            <th class="th-border" rowspan="2"><span class="necessary">*</span>所属车队</th>
            <th class="th-border" rowspan="2">车牌号</th>
            <th class="th-border" rowspan="2">座位数</th>
            <th class="th-border" rowspan="2"><span class="necessary">*</span>车费</th>
            <th class="th-border" rowspan="2">优惠</th>
            <th class="th-border" rowspan="2">应付</th>
            <th class="th-border" rowspan="2">已付</th>
            <th class="th-border" colspan="5">导游实销</th>
            <th class="th-border" rowspan="2">操作</th>
        </tr>
        <tr>
            <th class="th-border">导游</th>
            <th class="th-border">付款方式</th>
            <th class="th-border">金额</th>
            <th class="th-border">单据</th>
            <th class="th-border">导游报账备注</th>
            <th class="th-border" rowspan="2">是否对账</th>
        </tr>
        </thead>
        <tbody class="T-count-bus">
        {{if busCompanyArranges != null}}
            {{if busCompanyArranges.listMap.length}}
                {{each busCompanyArranges.listMap as arrange index}}
                    <tr busArrangeId="{{arrange.id}}" badStatus = "{{arrange.badStatus}}"
                    isConfirmAccount="{{arrange.isConfirmAccount}}">
                        <td>{{arrange.startTime | dateFormat: 'yyyy-MM-dd'}}</td><!-- 开始时间 -->

                        <td>{{arrange.endTime | dateFormat: 'yyyy-MM-dd'}}</td><!-- 结束时间 -->

                        <td>
                            {{ if arrange.taskType == 0}}
                                    全程
                                {{else if arrange.taskType == 1}}
                                    接机
                                {{else if arrange.taskType == 2}}
                                    送机
                                {{else if arrange.taskType == 3}}
                                    前段
                                {{else if arrange.taskType == 4}}
                                    中段
                                {{else if arrange.taskType == 5}}
                                    后段
                            {{/if}}
                        </td><!-- 任务 -->

                        <td><span class="companyName">{{arrange.companyName}}</span></td><!-- 车队 -->

                        <td>{{arrange.licenseNumber}}</td><!-- 车牌号 -->

                        <td><span calss="F-float F-count">{{arrange.seatCount}}</span></td>

                        <td>
                            {{if arrange.badStatus == 1}}
                                <span class="F-float F-money">{{arrange.realPrice}}</span>
                            {{else}}
                                <input type="text" name="price" value="{{arrange.realPrice}}" class="w-80 F-float F-money" 
                                {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}}/>
                            {{/if}}
                            <input type="hidden" name="realCount" value="1" />
                        </td><!-- 车费 -->

                        <td>
                            {{if arrange.badStatus == 1}}
                                <span class="F-float F-money">{{arrange.realReduceMoney}}</span>
                            {{else}}
                                <input type="text" class="w-80 F-float F-money" name="realReduceMoney" value="{{arrange.realReduceMoney}}" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}}/>
                            {{/if}}
                        </td><!-- 优惠 -->

                        <td>
                            {{if arrange.badStatus == 1}}
                                <span class="BusneedPayMoney F-float F-money">
                                    {{arrange.realNeedPayMoney}}
                                </span>
                            {{else}}
                                {{if arrange.isConfirmAccount == 1}}
                                    <span class="BusneedPayMoney F-float F-money">{{arrange.realNeedPayMoney}}</span>
                                {{else}}
                                    <span class="BusneedPayMoney F-float F-money"></span>
                                {{/if}}
                            {{/if}}
                            <input type="hidden" name="needPayMoney" value="{{arrange.realNeedPayMoney}}"/>
                            </td><!-- 应付 -->

                        <td><span class="F-float F-money">{{arrange.payedMoney}}</span></td><!-- 已付 -->
                        
                        <td name="guideName">
                            <div class="div-h-30">
                                <button class="btn btn-success btn-sm btn-white T-addGuide pull-right"> 
                                    <i class="ace-icon fa fa-plus bigger-110 icon-only"></i>
                                </button>
                                <!-- <a href="#" class="T-addGuide pull-right">增加</a> --><!-- 增加导游 -->
                            </div>
                            {{if !!arrange.guideDetails && arrange.guideDetails.length}}
                                {{each arrange.guideDetails as rs index}}
                                    <div class="div-h-30 mar-t-5" index="{{index+1}}" guideId = "{{rs.id}}">
                                        <span class="guideName">{{rs.guideName}}</span>
                                        <input name="guideId" value="{{rs.id}}" type="hidden" />
                                        <input name="guideName" value="{{rs.guideName}}" type="hidden" />
                                        <input name="guideArrangeId" value="{{rs.guideArrangeId}}" type="hidden" />
                                        <button class="btn btn-danger btn-sm btn-white T-delGuide pull-right"> 
                                            <i class="ace-icon fa fa-minus bigger-110 icon-only"></i>
                                        </button>
                                        <!-- 删除导游 -->
                                    </div>
                                {{/each}}
                                {{else}}
                                    <div class="div-h-30 mar-t-5" index="1">
                                        <input name="guideArrangeId" type="hidden" />
                                        <input name="guideName"  type="text" class="w-80" {{if arrange.isConfirmAccount==1 }}readOnly="readOnly" {{/if}}/>
                                        <button class="btn btn-danger btn-sm btn-white T-delGuide pull-right"> 
                                            <i class="ace-icon fa fa-minus bigger-110 icon-only"></i>
                                        </button>
                                        <!-- <a href="#" class="T-delGuide pull-right">删除</a> -->
                                        <!-- 删除导游 -->
                                    </div>
                            {{/if}}
                            
                        </td><!-- 导游 -->
                        
                        <td name="payType">
                            <div class="div-h-30"></div>
                            {{if !!arrange.guideDetails && arrange.guideDetails.length}}
                                {{each arrange.guideDetails as rs index}}
                                    <div class="div-h-30 mar-t-5" index="{{index+1}}">
                                        <select name="payType" {{if arrange.isConfirmAccount == 1}}disabled="disabled"{{/if}}>
                                            <option value="0" {{if rs.realPayType == 0}}selected="selected"{{/if}}>现金</option>
                                            <option value="1" {{if rs.realPayType == 1}}selected="selected"{{/if}}>刷卡</option>
                                            <option value="2" {{if rs.realPayType == 2}}selected="selected"{{/if}}>签单</option>
                                        </select>
                                    </div>
                                {{/each}}
                            {{else}}
                                <div class="div-h-30 mar-t-5" index="1" {{if arrange.isConfirmAccount == 1}}disabled="disabled"{{/if}}>
                                    <select name="payType">
                                            <option value="0" >现金</option>
                                            <option value="1" >刷卡</option>
                                            <option value="2" >签单</option>
                                    </select>
                                </div>
                            {{/if}}
                        </td><!-- 付款方式 -->
                        
                        <td name="guidePayedMoney">
                            <div class="div-h-30"></div>
                            {{if !!arrange.guideDetails && arrange.guideDetails.length}}
                                {{each arrange.guideDetails as rs index}}
                                    <div class="div-h-30 mar-t-5" index="{{index+1}}">
                                        <input name="guidePayedMoney" value="{{rs.guidePayedMoney}}" class="w-80" 
                                        {{if arrange.isConfirmAccount==1 }}readOnly="readOnly" {{/if}}/>
                                    </div>
                                {{/each}}
                            {{else}}
                                <div class="div-h-30 mar-t-5" index="1">
                                    <input name="guidePayedMoney" class="w-80" {{if arrange.isConfirmAccount==1 }}readOnly="readOnly" {{/if}}/>
                                </div>
                            {{/if}}
                        </td><!-- 金额 -->
                        
                        <td name="billImage">
                            <div class="div-h-30"></div>
                            {{if !!arrange.guideDetails && arrange.guideDetails.length}}
                                {{each arrange.guideDetails as rs index}}
                                    <div class="div-h-30 mar-t-5" index="{{index+1}}">
                                       {{if rs.billImage != null && rs.billImage != ""}}
                                        <a href="javascript:void(0);" url="{{rs.billImage}}" class="btn-view">查看</a>
                                    {{else}}
                                        <span style="color:#bbb;">查看</span>
                                    {{/if}}
                                    </div>
                                {{/each}}
                            {{else}}
                                <div class="div-h-30 mar-t-5" index="1">
                                    <span style="color:#bbb;">查看</span>
                                </div>
                            {{/if}}
                        </td><!-- 单据 -->
                        
                        <td name="billRemark">
                            <div class="div-h-30"></div>
                            {{if !!arrange.guideDetails && arrange.guideDetails.length}}
                                {{each arrange.guideDetails as rs index}}
                                    <div class="div-h-30 mar-t-5" index="{{index+1}}">
                                        <input name="billRemark" value="{{rs.billRemark}}"
                                        {{if arrange.isConfirmAccount==1 }}readOnly="readOnly" {{/if}}/>
                                    </div>
                                {{/each}}
                            {{else}}
                                <div class="div-h-30 mar-t-5" index="1">
                                    <input name="billRemark" {{if arrange.isConfirmAccount==1 }}readOnly="readOnly" {{/if}}/>
                                </div>
                            {{/if}}
                        </td><!-- 备注 -->



                        <td><input value="{{busCompany.billRemark}}" name="billRemark" type="text" {{if busCompany.isConfirmAccount == 1}}readOnly="readOnly"{{/if}}/></td>

                        <td>
                            {{if busCompany.isConfirmAccount == 0 }}
                                未对账
                            {{else}}
                                已对账
                            {{/if}}
                            &nbsp;&nbsp;
                            {{if busCompany.payedMoney == 0 && busCompany.isConfirmAccount == 0}}
                                <a href="javascript:void(0)" class="T-busArrDel">删除</a>
                            {{else}}
                                <span style="color:#bbb;">删除</span>
                            {{/if}}
                        </td>
                    </tr>
                {{/each}}
            {{/if}}
        {{/if}}
        </tbody>
    </table>
</div>

{{if tripPlan.billStatus > -1}}
    <div style="width:60%;">
        <div> 
            <label style="margin:5px 0px 0px 0px;">财务审核批注：</label>
            <input name="accountFinancialCheckComment" {{if !isFinance }}readonly="readonly"{{/if}} type="text" style="width:30%;" value="{{if remarkArrangeList.busRemark.length>0}}{{remarkArrangeList.busRemark[0].opCheckRemark}}{{/if}}" />
        
            <label style="margin:5px 0px 0px 10px;">计调审核批注：</label>
            <input name="accountOPCheckComment" {{if (!(tripPlan.billStatus == 0 && isOp)) }}readonly="readonly"{{/if}} type="text" style="width:30%;" value="{{if remarkArrangeList.busRemark.length>0}}{{remarkArrangeList.busRemark[0].financeCheckRemark}}{{/if}}" />
        </div>
    </div>
{{/if}}