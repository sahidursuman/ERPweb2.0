<div class="ui-sortable-handle widget-container-col">
    <h5 class="title-size">
        <i class="ace-icon fa fa-medkit"></i> 餐费
        <a href="javascript:void(0)" class="T-restaurantpay-add">
            <button class="btn btn-sm btn-success T-add" style="margin-left: 20px">
                <i class="ace-icon fa fa-plus"></i>
                新增
            </button>
        </a>
    </h5>
</div>
<div class="overflow-x min-w-1050">
<table class="table table-striped table-bordered table-hover w-1500">
    <thead>
        <tr>
            <th class="th-border"><span class="necessary">*</span>时间</th>
            <th class="th-border"><span class="necessary">*</span>餐厅</th>
            <th class="th-border"><span class="necessary">*</span>类型</th>
            <th class="th-border"><span class="necessary">*</span>餐标</th>
            <th class="th-border"><span class="necessary">*</span>人数</th>
            <th class="th-border">优惠</th>
            <th class="th-border">应付</th>
            <th class="th-border">已付</th>
            <th class="th-border">导付</th>
            <th class="th-border">单据</th>
            <th class="th-border">差额</th>
            <th class="th-border">导游报账备注</th>
            <th class="th-border" rowspan="2">是否对账</th>
        </tr>
    </thead>
    <tbody class="T-count-restaurant"> 
    {{each dayList as day}}
    {{if day.restaurantArrange != null}}
    {{each day.restaurantArrange as arrangeList}}
    {{each arrangeList.restaurantArrangeList as arrange index}}
    {{if arrange != null}}
    <tr badStatus = "{{arrange.badStatus}}"  isChoose="{{arrange.isChoose}}" restaurantArrangeId="{{arrange.id}}" restaurantId="{{if arrange.restaurant != null}}{{arrange.restaurant.id}}{{/if}}" restaurantStandardId="{{if arrange.restaurantStandard != null}}{{arrange.restaurantStandard.id}}{{/if}}" whichDay="{{arrange.whichDay}}"
    isConfirmAccount="{{arrange.isConfirmAccount}}">
        {{if index == 0}}<td rowspan="{{arrangeList.restaurantArrangeList.length}}"><span class="whichDay"></span></td>{{/if}}

        {{if index == 0}}
            <td rowspan="{{arrangeList.restaurantArrangeList.length}}">
                {{if tripPlan.billStatus == -1}}
                    {{if arrange.isChoose == 1}}
                        <select name="chooseRest">
                            <option value="">导游自选</option>
                            {{each arrange.restaurantChooseArrangeList as rs}}
                                <option value="{{rs.restaurantId}}" 
                                {{if arrange.restaurantId == rs.restaurantId}}selected="selected"{{/if}}>{{rs.name}}</option>
                            {{/each}}
                        </select>
                    {{else}}
                        {{if arrange.restaurant != null}}
                            <span class="nameType">{{arrange.restaurant.name}}</span>
                        {{/if}}
                    {{/if}}
                {{else}}
                    {{if arrange.billUpdateTime != null}}
                        {{if arrange.restaurantId == -1 && arrange.restaurantChooseArrangeList.length > 0}}
                            <select name="chooseRest">
                                <option value="">导游自选</option>
                                {{each arrange.restaurantChooseArrangeList as rs}}
                                    <option value="{{rs.restaurantId}}" 
                                    {{if arrange.restaurantId == rs.restaurantId}}selected="selected"{{/if}}>{{rs.name}}</option>
                                {{/each}}
                            </select>
                        {{else if arrange.restaurantId == -1 && arrange.restaurantChooseArrangeList.length == 0}}
                            <span class="nameType">导游自选</span>
                        {{else if arrange.restaurantId != -1}}
                            {{if arrange.restaurant !=null}}
                                <span class="nameType">{{arrange.restaurant.name}}</span>
                            {{/if}}
                        {{/if}}
                    {{else}}
                        {{if arrange.restaurantId == -1}}
                            <span class="nameType">导游自选</span>
                        {{else}}
                            {{if arrange.restaurant !=null}}
                                <span class="nameType">{{arrange.restaurant.name}}</span>
                            {{/if}}
                        {{/if}}
                    {{/if}}
                {{/if}}
            </td>
        {{/if}}

        <td>{{arrange.type}}</td> 

        <td>
        {{if tripPlan.billStatus == -1}}
            {{if arrange.isChoose == 1}}
                <input  value="{{arrange.realPrice}}" type="text" name="price" class="w-80" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}}/>
                <input type="hidden" name="standardId"><input type="hidden" name="type" value="{{arrange.type}}">
            {{else}}
                <span class="F-float F-money">{{arrange.realPrice}}</span>
                <input type="hidden" name="price" value="{{arrange.realPrice}}"/>
            {{/if}}
        {{else}}
            {{if arrange.badStatus == 1}}
                <input type="text" name="price" value="{{arrange.realPrice}}" class="w-80" readOnly="readOnly"/>
            {{else}}
                <input type="text" name="price" value="{{arrange.realPrice}}" class="w-80" {{if arrange.isConfirmAccount==1 }}readOnly="readOnly" {{/if}}/><input type="hidden" name="standardId">
            {{/if}}
        {{/if}}
        </td>

        <td>
            {{if arrange.badStatus == 1}}
                <span class="F-float F-count">
                    {{arrange.memberCount}}
                </span>
                {{else}}
                    <input  type="text" class="F-float F-count w-50" name="realCount" {{if arrange.billUpdateTime != null}}value="{{arrange.realCount}}"
                    {{else}}value="{{arrange.memberCount}}"{{/if}}  maxlength="5"
                    {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}}/>
            {{/if}}
        </td>

        <td>{{if arrange.badStatus == 1}}<span class="F-float F-money w-80">{{arrange.realReduceMoney}}</span>{{else}}<input type="text" name="realReduceMoney" class="F-float F-money w-80" value="{{arrange.realReduceMoney}}" 
        {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}}/>{{/if}}
        </td>

        <td>
        {{if arrange.badStatus == 1}}
            <span class="restneedPayMoney F-float F-money">{{arrange.payedMoney+arrange.realGuidePayMoney}}</span>
        {{else}}
            {{if arrange.isConfirmAccount == 1}}
                <span class="restneedPayMoney F-float F-money" >{{arrange.tempSettlementMoney}}</span>
            {{else}}
                <span class="restneedPayMoney"></span>
            {{/if}}

        {{/if}}
        <input type="hidden" value="{{arrange.payedMoney}}" name="needPayMoney"></td>

        <td><span class="F-float F-money">{{arrange.payedMoney}}</span></td>

        <td><div class="inline-flex">
        
        {{if arrange.badStatus == 1}}
        <span>
            {{if arrange.realPayType == 0}}
                现金
                {{else if arrange.realPayType == 1}}
                刷卡
                {{else if arrange.realPayType == 2}}
                签单
            {{/if}}
        </span>
        &nbsp;
        <span class="F-float F-money">{{if arrange.payType == 2}}{{arrange.realSignMoney}}{{else}}{{arrange.realGuidePayMoney}}{{/if}}</span>{{else}}
        <select name="payType" {{if arrange.isConfirmAccount == 1}}disabled="disabled"{{/if}}>
            <option value="0" {{if arrange.realPayType == 0}}selected="selected"{{/if}}>现金</option>
            <option value="1" {{if arrange.realPayType == 1}}selected="selected"{{/if}}>刷卡</option>
            <option value="2" {{if arrange.realPayType == 2}}selected="selected"{{/if}}>签单</option>
        </select>
        &nbsp;
        <input  type="text" class="F-float F-money w-80" name="realGuidePayMoney" 
        {{if arrange.realPayType == 2}}value="{{arrange.realSignMoney}}"{{else}}{{if arrange.billUpdateTime != null}}value="{{arrange.realGuidePayMoney}}"{{else}}value="{{arrange.guidePayMoney}}" {{/if}} maxlength="11" {{/if}} {{if arrange.isConfirmAccount==1 }}readOnly="readOnly" {{/if}}/>{{/if}}
        <input type="hidden" name="payedMoney" value="{{arrange.payedMoney}}" />
        <input type="hidden" name="guidePayMoney" value="{{arrange.guidePayMoney}}" /></div></td>
        
        <td>{{if arrange.billImage != null && arrange.billImage != ""}}
                <a href="javascript:void(0);" url="{{arrange.billImage}}" class="btn-view">查看</a>
            {{else}}
                <span style="color:#bbb;">查看</span>
            {{/if}}
        </td>

        <td><span class="difference"></span></td>

        <td style="text-align: left;">
            <input name="billRemark" class="w-150" value="{{arrange.billRemark}}" maxlength="1000" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}}/>
        </td>

        <td>
            {{if arrange.isConfirmAccount == 0}}
                未对账
            {{else}}
                已对账
            {{/if}}
            &nbsp;&nbsp;
            {{if arrange.payedMoney == 0 &&　arrange.isConfirmAccount == 0}}
                <a href="javascript:void(0)" class="T-restArrDel">删除</a>
            {{else}}
                <span style="color:#bbb;">删除</span>
            {{/if}}
        </td>
    </tr>
    {{/if}}
    {{/each}}
    {{/each}}
    {{/if}}
    {{/each}}
    </tbody>
</table>
</div>
{{if tripPlan.billStatus > -1}}
    <div style="width:60%;">
        <div> 
            <label style="margin:5px 0px 0px 0px;">财务审核批注：</label>
            <input name="accountFinancialCheckComment" {{if (!(tripPlan.billStatus == 1 && isFinance)) }}readonly="readonly"{{/if}} type="text" style="width:30%;" value="{{if remarkArrangeList.restRemark.length>0}}{{remarkArrangeList.restRemark[0].opCheckRemark}}{{/if}}" />
        
            <label style="margin:5px 0px 0px 10px;">计调审核批注：</label>
            <input name="accountOPCheckComment" {{if (!(tripPlan.billStatus == 0 && isOp)) }}readonly="readonly"{{/if}} type="text" style="width:30%;" value="{{if remarkArrangeList.restRemark.length>0}}{{remarkArrangeList.restRemark[0].financeCheckRemark}}{{/if}}" />
        </div>
    </div>
{{/if}}