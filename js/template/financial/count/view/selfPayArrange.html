<div class="ui-sortable-handle widget-container-col">
    <h5 class="title-size">
        <i class="ace-icon fa fa-medkit"></i> 自费安排
        <a href="javascript:void(0)" class="T-addSelf">
            <button class="btn btn-sm btn-success T-add" style="margin-left: 20px">
                <i class="ace-icon fa fa-plus"></i>
                新增
            </button>
        </a>
    </h5>
</div>
<table class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
        <th class="th-border" colspan="14">消费</th>
        <th class="th-border" colspan="2">社佣</th>
        <th class="th-border" colspan="2">导佣</th>
        <!-- <th class="th-border" colspan="2">人数返佣</th> -->
        <th class="th-border" rowspan="2">导游报账备注</th>
        {{if tripPlan.billStatus == 2 }}<th class="th-border" rowspan="2">是否对账</th>{{/if}}
    </tr>
    <tr>
      <th class="th-border"><span class="necessary">*</span>时间</th>
      <th class="th-border"><span class="necessary">*</span>自费商家</th>
      <th class="th-border"><span class="necessary">*</span>项目</th>
      <th class="th-border"><span class="necessary">*</span>单价</th>
      <th class="th-border"><span class="necessary">*</span>底价</th>
      <th class="th-border">人数返佣</th>
      <th class="th-border"><span class="necessary">*</span>数量</th>
      <th class="th-border">优惠</th>
      <th class="th-border">应收</th>
      <th class="th-border">应付</th>
      <th class="th-border">已付</th>
      <th class="th-border">导付</th>
      <th class="th-border">现收</th>
      <th class="th-border">单据</th>
      <th class="th-border"><span class="necessary">*</span>比例%</th>
      <th class="th-border">返佣</th>
      <th class="th-border"><span class="necessary">*</span>比例%</th>
      <th class="th-border">返佣</th>
    </tr></thead>
    <tbody class="T-count-selfPay">
    {{each dayList as day}}
    {{if day.selfPayArrange != null}}
    {{each day.selfPayArrange as arrangeList}}
    {{each arrangeList.selfPayArrangeList as arrange index}}
    {{if arrange != null}}
    <tr selfPayArrangeId="{{arrange.id}}" selfPayId="{{arrange.selfPayId}}" badStatus = "{{arrange.badStatus}}" whichDay = {{arrange.whichDay}}>
            {{if index == 0 }}<td rowspan="{{arrangeList.selfPayArrangeList.length}}">第{{arrange.whichDay}}天</td>{{/if}}
            {{if index == 0 }}<td rowspan="{{arrangeList.selfPayArrangeList.length}}">{{arrange.selfPay.name}}</td>{{/if}}
            <td>{{if arrange.selfPayItem != null}}{{if arrange.selfPayItem != null}}{{arrange.selfPayItem.name}}{{/if}}{{else}}<input name="selfPayItemName" value="" type="text"><input name="selfPayItemId" type="hidden">{{/if}}</td>
            <td>
            {{if arrange.badStatus == 1}}<span class="marketPrice F-float F-money">{{arrange.marketPrice}}</span>{{else}}<span class="marketPrice F-float F-money">{{arrange.marketPrice}}</span>{{/if}}
            <input type="hidden" name="marketPrice" value="{{arrange.marketPrice}}"/></td>
            <td>{{if arrange.badStatus == 1}}<span class="price F-float F-money">{{arrange.price}}</span>{{else}}<span class="price F-float F-money">{{arrange.price}}</span>{{/if}}
            <input type="hidden" name="price" value="{{arrange.price}}" /></td>
            <td>{{if arrange.badStatus == 1}}<span class="customerRebateMoney F-float F-money">{{arrange.customerRebateMoney}}</span>{{else}}<span class="customerRebateMoney">{{if arrange.selfPayItem != null}}{{arrange.selfPayItem.customerRebateMoney}}{{else}}0{{/if}}</span>{{/if}}</td>
            <td>{{if arrange.badStatus == 1}}
            <span class='F-floatF-count'>{{arrange.memberCount}}</span>{{else}}<input style="width:60px;" type="text" name="realCount" class="F-floatF-count" {{if arrange.billUpdateTime != null}}value="{{arrange.realCount}}"{{else}}value=0{{/if}} maxlength="5"/>{{/if}}<input type="hidden" name="memberCount" value="{{arrange.memberCount}}" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}} /></td>
            <td>{{if arrange.badStatus == 1}}<span class="F-float F-money">{{arrange.realReduceMoney}}</span>{{else}}<input type="text" name="realrealReduceMoney" class="F-float F-money" value="{{arrange.realrealReduceMoney}}" style="width:60px;"/>{{/if}}
            </td>
            <td>{{if arrange.badStatus == 1}}<span class="needIncome F-float F-money"></span>{{else}}<span class="needIncome F-float F-money"></span>{{/if}}
            </td>
            <td><span class="needPayMoney F-float F-money" >{{arrange.payedMoney+arrange.realGuidePayMoney}}</span><input type="hidden" class="selfMoney"></td>
            <td><span class="F-float F-money">{{arrange.payedMoney}}</span></td>
            <td>{{if arrange.badStatus == 1}}<span class="F-float F-money">{{arrange.realGuidePayMoney}}</span>{{else}}<input style="width:60px;" type="text" class="F-float F-money" name="realGuidePayMoney" {{if arrange.billUpdateTime!=null}}value="{{arrange.realGuidePayMoney}}"{{else}}value=0 {{/if}} old="{{arrange.realGuidePayMoney}}" maxlength="11" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}} />{{/if}}
                
                <input type="hidden" name="payedMoney" value="{{arrange.payedMoney}}" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}} />
                <input type="hidden" name="guidePayMoney" value="{{arrange.guidePayMoney}}" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}} />
                </td>
            <td>{{if arrange.badStatus == 1}}<span class="F-float F-money">{{arrange.realGetMoney}}</span>{{else}}<input type="text" class="F-float F-money" name="realGetMoney" value="{{arrange.realGetMoney}}" style="width:60px;"/>{{/if}}
            </td>
            <td>{{if arrange.billImage != null && arrange.billImage != ""}}
                    <a href="javascript:void(0);" url="{{arrange.billImage}}" class="btn-view">查看</a>
                {{else}}
                    <span style="color:#bbb;">查看</span>
                {{/if}}
            </td>
            <td>{{if arrange.badStatus == 1}}<span>{{arrange.travelAgencyRate*100 | parseInt}}</span>{{else}}<input style="width:90px;" type="text" name="travelAgencyRate" value="{{arrange.travelAgencyRate*100 | parseInt}}" old="{{arrange.travelAgencyRate}}" maxlength="5" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}} />{{/if}}
                </td>
            <td>{{if arrange.badStatus == 1}}<span class="F-float F-money">{{arrange.travelAgencyRebateMoney}}</span>{{else}}<span class="travelAgencyRebateMoney F-float F-money">{{arrange.travelAgencyRebateMoney}}</span>{{/if}}
                <input type="hidden" name="travelAgencyRebateMoney" value="{{arrange.travelAgencyRebateMoney}}" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}} /></td>
            <td>{{if arrange.badStatus == 1}}<span>{{arrange.guideRate*100 | parseInt}}</span>{{else}}<input style="width:90px;" type="text" name="guideRate" value="{{arrange.guideRate*100 | parseInt}}" old="{{arrange.guideRate}}" maxlength="5"/>{{/if}}
            </td>
            <td>{{if arrange.badStatus == 1}}<span class="F-float F-money">{{arrange.guideRebateMoney}}</span>{{else}} <span class="guideRebateMoney F-float F-money">{{arrange.guideRebateMoney}}</span>{{/if}}
               
                <input type="hidden" name="guideRebateMoney" value="{{arrange.guideRebateMoney}}" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}} /></td>
            <!-- <td>
                <span class="guideRate">{{arrange.customerRebateMoney}}</span>
                <input type="hidden" name="guideRate" value="{{arrange.customerRebateMoney}}" {{if arrange.isConfirmAccount == 1}}readOnly="readOnly"{{/if}} /></td>
            {{if index == 0 }}<td rowspan="{{arrangeList.selfPayArrangeList.length}}">{{arrange.customerRebateMoney * tripPlan.touristAdultCount}}</td>{{/if}} -->
            <td>{{if editStatus == 1}}<input name="billRemark" value="{{if arrange.selfPayItem != null}}{{arrange.selfPayItem.remark}}{{else}}{{arrange.billRemark}}{{/if}}" maxlength="1000" />{{else}}{{if arrange.selfPayItem != null}}{{arrange.selfPayItem.remark}}{{else}}{{arrange.billRemark}}{{/if}}{{/if}}</td>
            {{if tripPlan.billStatus == 2}}<td>{{if arrange.isConfirmAccount == 0}}未对账{{else}}已对账{{/if}}</td>{{/if}}                              
    </tr>
    {{/if}}
    {{/each}}
    {{/each}}
    {{/if}}
    {{/each}}
    </tbody>
</table>

{{if tripPlan.billStatus > -1}}
    <div style="width:60%;">
        <div> 
            <label style="margin:5px 0px 0px 0px;">财务审核批注：</label>
            <input name="accountFinancialCheckComment" {{if (!(tripPlan.billStatus == 1 && isFinance)) }}readonly="readonly"{{/if}} type="text" style="width:30%;" value="{{if remarkArrangeList[2] != null}}{{remarkArrangeList[2].opCheckRemark}}{{/if}}" />
        
            <label style="margin:5px 0px 0px 10px;">计调审核批注：</label>
            <input name="accountOPCheckComment" {{if (!(tripPlan.billStatus == 0 && isOp)) }}readonly="readonly"{{/if}} type="text" style="width:30%;" value="{{if remarkArrangeList[2] != null}}{{remarkArrangeList[2].financeCheckRemark}}{{/if}}" />
        </div>
    </div>
{{/if}}